<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Doing Bayesain Analysis with ggformula and brms</title>
  <meta name="description" content="Doing Bayesain Analysis with ggformula and brms">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Doing Bayesain Analysis with ggformula and brms" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Doing Bayesain Analysis with ggformula and brms" />
  
  
  

<meta name="author" content="R Pruim">


<meta name="date" content="2019-01-07">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="bayes-rule-and-the-grid-method.html">
<link rel="next" href="heierarchical-models.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introdcution</a></li>
<li class="chapter" data-level="2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html"><i class="fa fa-check"></i><b>2</b> Introduction: Credibility, Models, and Parameters</a><ul>
<li class="chapter" data-level="2.1" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#bayesian-inference-is-reallocation-of-credibility-across-possibilities"><i class="fa fa-check"></i><b>2.1</b> Bayesian Inference is Reallocation of Credibility Across Possibilities</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#possibilities-are-parameter-values-in-descriptive-models"><i class="fa fa-check"></i><b>2.2</b> Possibilities Are Parameter Values in Descriptive Models</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-credibility-models-and-parameters.html"><a href="introduction-credibility-models-and-parameters.html#the-steps-of-bayesian-data-analysis"><i class="fa fa-check"></i><b>2.3</b> The Steps of Bayesian Data Analysis</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html"><i class="fa fa-check"></i><b>3</b> Some Useful Bits of R</a><ul>
<li class="chapter" data-level="3.1" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html#vectors-lists-and-data-frames"><i class="fa fa-check"></i><b>3.1</b> Vectors, Lists, and Data Frames</a><ul>
<li class="chapter" data-level="3.1.1" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html#vectors"><i class="fa fa-check"></i><b>3.1.1</b> Vectors</a></li>
<li class="chapter" data-level="3.1.2" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html#lists"><i class="fa fa-check"></i><b>3.1.2</b> Lists</a></li>
<li class="chapter" data-level="3.1.3" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html#data-frames-for-rectangular-data"><i class="fa fa-check"></i><b>3.1.3</b> Data frames for rectangular data</a></li>
<li class="chapter" data-level="3.1.4" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html#other-types-of-data"><i class="fa fa-check"></i><b>3.1.4</b> Other types of data</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html#plotting-with-ggformula"><i class="fa fa-check"></i><b>3.2</b> Plotting with ggformula</a></li>
<li class="chapter" data-level="3.3" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html#creating-data-with-expand.grid"><i class="fa fa-check"></i><b>3.3</b> Creating data with expand.grid()</a></li>
<li class="chapter" data-level="3.4" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html#transforming-and-summarizing-data-dplyr"><i class="fa fa-check"></i><b>3.4</b> Transforming and summarizing data dplyr</a></li>
<li class="chapter" data-level="3.5" data-path="some-useful-bits-of-r.html"><a href="some-useful-bits-of-r.html#wide-data-vs-long-data-and-other-uses-of-tidyr"><i class="fa fa-check"></i><b>3.5</b> Wide Data vs Long Data and other uses of tidyr</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html"><i class="fa fa-check"></i><b>4</b> What is this thing called probability? {4}</a><ul>
<li class="chapter" data-level="4.1" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#the-set-of-all-possible-events"><i class="fa fa-check"></i><b>4.1</b> The Set of All Possible Events</a><ul>
<li class="chapter" data-level="4.1.1" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#simulating"><i class="fa fa-check"></i><b>4.1.1</b> Simulating</a></li>
<li class="chapter" data-level="4.1.2" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#deriving"><i class="fa fa-check"></i><b>4.1.2</b> Deriving</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#probability-outside-or-inside-the-head"><i class="fa fa-check"></i><b>4.2</b> Probability: Outside or Inside the Head</a><ul>
<li class="chapter" data-level="4.2.1" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#calibrating-subjective-belief-by-preferences"><i class="fa fa-check"></i><b>4.2.1</b> Calibrating subjective belief by preferences</a></li>
<li class="chapter" data-level="4.2.2" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#describing-subjective-belief-maathematically"><i class="fa fa-check"></i><b>4.2.2</b> Describing subjective belief maathematically</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#probability-distributions"><i class="fa fa-check"></i><b>4.3</b> Probability Distributions</a><ul>
<li class="chapter" data-level="4.3.1" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#discrete-probability-mass"><i class="fa fa-check"></i><b>4.3.1</b> Discrete: Probability mass</a></li>
<li class="chapter" data-level="4.3.2" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#continuous-density"><i class="fa fa-check"></i><b>4.3.2</b> Continuous: Density</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#two-way-distributions"><i class="fa fa-check"></i><b>4.4</b> Two-Way Distributions</a><ul>
<li class="chapter" data-level="4.4.1" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#conditional-probability"><i class="fa fa-check"></i><b>4.4.1</b> Conditional probability</a></li>
<li class="chapter" data-level="4.4.2" data-path="what-is-this-thing-called-probability-4.html"><a href="what-is-this-thing-called-probability-4.html#independence-of-attributes"><i class="fa fa-check"></i><b>4.4.2</b> Independence of attributes</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="bayes-rule-and-the-grid-method.html"><a href="bayes-rule-and-the-grid-method.html"><i class="fa fa-check"></i><b>5</b> Bayes’ Rule and the Grid Method</a><ul>
<li class="chapter" data-level="5.1" data-path="bayes-rule-and-the-grid-method.html"><a href="bayes-rule-and-the-grid-method.html#estimating-the-bias-in-a-coin-using-the-grid-method"><i class="fa fa-check"></i><b>5.1</b> Estimating the bias in a coin using the Grid Method</a><ul>
<li class="chapter" data-level="5.1.1" data-path="bayes-rule-and-the-grid-method.html"><a href="bayes-rule-and-the-grid-method.html#creating-a-grid"><i class="fa fa-check"></i><b>5.1.1</b> Creating a Grid</a></li>
<li class="chapter" data-level="5.1.2" data-path="bayes-rule-and-the-grid-method.html"><a href="bayes-rule-and-the-grid-method.html#plots-from-the-grid"><i class="fa fa-check"></i><b>5.1.2</b> Plots from the grid</a></li>
<li class="chapter" data-level="5.1.3" data-path="bayes-rule-and-the-grid-method.html"><a href="bayes-rule-and-the-grid-method.html#hdi-from-the-grid"><i class="fa fa-check"></i><b>5.1.3</b> HDI from the grid</a></li>
<li class="chapter" data-level="5.1.4" data-path="bayes-rule-and-the-grid-method.html"><a href="bayes-rule-and-the-grid-method.html#automating-the-grid"><i class="fa fa-check"></i><b>5.1.4</b> Automating the grid</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html"><i class="fa fa-check"></i><b>6</b> JAGS – Just Another Gibbs Sampler</a><ul>
<li class="chapter" data-level="6.1" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#what-jags-is"><i class="fa fa-check"></i><b>6.1</b> What JAGS is</a></li>
<li class="chapter" data-level="6.2" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#a-complete-example-estimating-a-proportion"><i class="fa fa-check"></i><b>6.2</b> A Complete Example: estimating a proportion</a><ul>
<li class="chapter" data-level="6.2.1" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#the-model"><i class="fa fa-check"></i><b>6.2.1</b> The Model</a></li>
<li class="chapter" data-level="6.2.2" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#load-data"><i class="fa fa-check"></i><b>6.2.2</b> Load Data</a></li>
<li class="chapter" data-level="6.2.3" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#specify-the-model"><i class="fa fa-check"></i><b>6.2.3</b> Specify the model</a></li>
<li class="chapter" data-level="6.2.4" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#run-the-model"><i class="fa fa-check"></i><b>6.2.4</b> Run the model</a></li>
<li class="chapter" data-level="6.2.5" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#using-coda"><i class="fa fa-check"></i><b>6.2.5</b> Using coda</a></li>
<li class="chapter" data-level="6.2.6" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#using-bayesplot"><i class="fa fa-check"></i><b>6.2.6</b> Using bayesplot</a></li>
<li class="chapter" data-level="6.2.7" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#using-kruschkes-functions"><i class="fa fa-check"></i><b>6.2.7</b> Using Kruschke’s functions</a></li>
<li class="chapter" data-level="6.2.8" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#optional-arguments-to-jags"><i class="fa fa-check"></i><b>6.2.8</b> Optional arguments to jags()</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#example-2-comparing-two-proportions"><i class="fa fa-check"></i><b>6.3</b> Example 2: comparing two proportions</a><ul>
<li class="chapter" data-level="6.3.1" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#the-data"><i class="fa fa-check"></i><b>6.3.1</b> The data</a></li>
<li class="chapter" data-level="6.3.2" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#the-model-1"><i class="fa fa-check"></i><b>6.3.2</b> The model</a></li>
<li class="chapter" data-level="6.3.3" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#describing-the-model-to-jags"><i class="fa fa-check"></i><b>6.3.3</b> Describing the model to JAGS</a></li>
<li class="chapter" data-level="6.3.4" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#fitting-the-model"><i class="fa fa-check"></i><b>6.3.4</b> Fitting the model</a></li>
<li class="chapter" data-level="6.3.5" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#inspecting-the-results"><i class="fa fa-check"></i><b>6.3.5</b> Inspecting the results</a></li>
<li class="chapter" data-level="6.3.6" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#differnce-in-proportions"><i class="fa fa-check"></i><b>6.3.6</b> Differnce in proportions</a></li>
<li class="chapter" data-level="6.3.7" data-path="jags-just-another-gibbs-sampler.html"><a href="jags-just-another-gibbs-sampler.html#sampling-from-the-prior"><i class="fa fa-check"></i><b>6.3.7</b> Sampling from the prior</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="heierarchical-models.html"><a href="heierarchical-models.html"><i class="fa fa-check"></i><b>7</b> Heierarchical Models</a><ul>
<li class="chapter" data-level="7.1" data-path="heierarchical-models.html"><a href="heierarchical-models.html#one-coin-from-one-mint"><i class="fa fa-check"></i><b>7.1</b> One coin from one mint</a></li>
<li class="chapter" data-level="7.2" data-path="heierarchical-models.html"><a href="heierarchical-models.html#multiple-coins-from-one-mint"><i class="fa fa-check"></i><b>7.2</b> Multiple coins from one mint</a></li>
<li class="chapter" data-level="7.3" data-path="heierarchical-models.html"><a href="heierarchical-models.html#multiple-coins-from-multiple-mints"><i class="fa fa-check"></i><b>7.3</b> Multiple coins from multiple mints</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Doing Bayesain Analysis with ggformula and brms</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="jags-just-another-gibbs-sampler" class="section level1">
<h1><span class="header-section-number">6</span> JAGS – Just Another Gibbs Sampler</h1>
<p>This chapter focuses on a very simple model – one for which JAGS is overkill.
This allows us to get familiar with JAGS and the various tools to investigate
JAGS models in a simple setting before moving on to more intersting models soon.</p>
<div id="what-jags-is" class="section level2">
<h2><span class="header-section-number">6.1</span> What JAGS is</h2>
<p>JAGS (Just Another Gibbs Sampler) is an implementation of an MCMC algorithm
called Gibbs sampling to sample the posterior distribution of a Bayesian model.</p>
<p>We will interact with JAGS from within R using the following packages:</p>
<ul>
<li>R2jags – interface between R and JAGS</li>
<li>coda – general tools for analysing and graphing MCMC algorithms</li>
<li>bayesplot – a number of useful plots using <code>ggplot2</code></li>
<li>CalvinBayes – includes some of the functions from Kruschke’s text</li>
</ul>
</div>
<div id="a-complete-example-estimating-a-proportion" class="section level2">
<h2><span class="header-section-number">6.2</span> A Complete Example: estimating a proportion</h2>
<div id="the-model" class="section level3">
<h3><span class="header-section-number">6.2.1</span> The Model</h3>
<p><img src="images/Bernoulli-model.png" width="914" /></p>
</div>
<div id="load-data" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Load Data</h3>
<p>The data sets provided as csv files by Kruschke also live in the <code>CalvinBayes</code>
package, so you can read this file with</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">library</span>(CalvinBayes)</a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="kw">data</span>(<span class="st">&quot;z15N50&quot;</span>)</a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="kw">glimpse</span>(z15N50)</a></code></pre></div>
<pre><code>## Observations: 50
## Variables: 1
## $ y &lt;dbl&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 1, ...</code></pre>
<p>We see that the data are coded as 50 0’s and 1’s in a variable named <code>y</code>.
(You should use better names when creating your own data sets.)</p>
</div>
<div id="specify-the-model" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Specify the model</h3>
<p>We can specify the model by creating a text file containing the JAGS description
of the model or by creating a special kind of function. The avoids creating
temporary files and keeps tidy in our R markdown documents. The main
part of the model description is the same in either style, but notice
that the using the function style, we do not need to include <code>model{ ... }</code>
in our description.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">bern_model &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb41-2" data-line-number="2">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>N) {</a>
<a class="sourceLine" id="cb41-3" data-line-number="3">    <span class="co"># each response is Bernoulli with fixed parameter theta</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4">    y[i] <span class="op">~</span><span class="st"> </span><span class="kw">dbern</span>(theta)  </a>
<a class="sourceLine" id="cb41-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb41-6" data-line-number="6">  theta <span class="op">~</span><span class="st"> </span><span class="kw">dbeta</span>(<span class="dv">1</span>, <span class="dv">1</span>)    <span class="co"># prior for theta</span></a>
<a class="sourceLine" id="cb41-7" data-line-number="7">}</a></code></pre></div>
</div>
<div id="run-the-model" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Run the model</h3>
<p><code>R2jags::jags()</code> can be used to run our JAGS model. We need to specify
three things:
(1) the model we are using (as defined above),
(2) the data we are using,
(3) the parameters we want saved in the posterior sampling.
(<code>theta</code> is the only parameter in this model,
but in larger models, we might choose to save only some of the parameters).</p>
<p>There are some additional, optional things we might want to control as well.<br />
More on those later. For now, let’s fit the model using the default values
for everything else.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="co"># Load the R2jags package</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="kw">library</span>(R2jags)</a>
<a class="sourceLine" id="cb42-3" data-line-number="3"></a>
<a class="sourceLine" id="cb42-4" data-line-number="4"><span class="co"># Make the same &quot;random&quot; choices each time this is run.</span></a>
<a class="sourceLine" id="cb42-5" data-line-number="5"><span class="co"># This makes the Rmd file stable so you can comment on specific results.</span></a>
<a class="sourceLine" id="cb42-6" data-line-number="6"><span class="kw">set.seed</span>(<span class="dv">123</span>)    </a>
<a class="sourceLine" id="cb42-7" data-line-number="7"></a>
<a class="sourceLine" id="cb42-8" data-line-number="8"><span class="co"># Fit the model</span></a>
<a class="sourceLine" id="cb42-9" data-line-number="9">bern_jags &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb42-10" data-line-number="10"><span class="st">  </span><span class="kw">jags</span>(</a>
<a class="sourceLine" id="cb42-11" data-line-number="11">    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> z15N50<span class="op">$</span>y, <span class="dt">N =</span> <span class="kw">nrow</span>(z15N50)),</a>
<a class="sourceLine" id="cb42-12" data-line-number="12">    <span class="dt">model.file =</span> bern_model,</a>
<a class="sourceLine" id="cb42-13" data-line-number="13">    <span class="dt">parameters.to.save =</span> <span class="kw">c</span>(<span class="st">&quot;theta&quot;</span>)</a>
<a class="sourceLine" id="cb42-14" data-line-number="14">  )</a></code></pre></div>
<pre><code>## module glm loaded</code></pre>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 50
##    Unobserved stochastic nodes: 1
##    Total graph size: 53
## 
## Initializing model</code></pre>
<p>Let’s take a quick look at what we have.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">bern_jags</a></code></pre></div>
<pre><code>## Inference for Bugs model at &quot;/var/folders/py/txwd26jx5rq83f4nn0f5fmmm0000gn/T//Rtmp9Zny9g/model6fd43388b7ff.txt&quot;, fit using jags,
##  3 chains, each with 2000 iterations (first 1000 discarded)
##  n.sims = 3000 iterations saved
##          mu.vect sd.vect   2.5%    25%    50%    75%  97.5%  Rhat n.eff
## theta      0.308   0.064  0.191  0.261  0.306  0.351  0.435 1.001  3000
## deviance  62.089   1.395 61.087 61.186 61.571 62.459 65.770 1.001  3000
## 
## For each parameter, n.eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor (at convergence, Rhat=1).
## 
## DIC info (using the rule, pD = var(deviance)/2)
## pD = 1.0 and DIC = 63.1
## DIC is an estimate of expected predictive error (lower deviance is better).</code></pre>
<p>We see that the average value of <code>theta</code> in our posterior distribution is
0.3075345. The values of <code>Rhat</code> and
<code>n.eff</code> give a quick check that nothing disasterous seems to have happened
when we fit this simple model. (<code>Rhat</code> should be very nearly 1 if the MCMC
algorithm has converged. Because <code>n.eff</code> is close to <span class="math inline">\(3000 = 3 \cdot 1000\)</span>,
this model is sampling the posterior very effeciently.)</p>
<p>We can plot the posterior distribution.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1"><span class="kw">library</span>(CalvinBayes)</a>
<a class="sourceLine" id="cb47-2" data-line-number="2"><span class="kw">head</span>(<span class="kw">posterior</span>(bern_jags))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">deviance</th>
<th align="right">theta</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">61.85316</td>
<td align="right">0.2454862</td>
</tr>
<tr class="even">
<td align="right">61.12541</td>
<td align="right">0.3128974</td>
</tr>
<tr class="odd">
<td align="right">61.13378</td>
<td align="right">0.2860278</td>
</tr>
<tr class="even">
<td align="right">61.12806</td>
<td align="right">0.3133316</td>
</tr>
<tr class="odd">
<td align="right">61.82968</td>
<td align="right">0.3576552</td>
</tr>
<tr class="even">
<td align="right">62.84865</td>
<td align="right">0.2193062</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">gf_dhistogram</span>(<span class="op">~</span>theta, <span class="dt">data =</span> <span class="kw">posterior</span>(bern_jags)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="kw">gf_dens</span>(<span class="op">~</span>theta, <span class="dt">data =</span> <span class="kw">posterior</span>(bern_jags))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="using-coda" class="section level3">
<h3><span class="header-section-number">6.2.5</span> Using coda</h3>
<p>The <code>coda</code> package provides output analysis and diagnostics for
MCMC algorithms. In order to use it, we must convert our JAGS object
into something <code>coda</code> recognizes.
We do with with the <code>as.mcmc()</code> function.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">bern_mcmc &lt;-<span class="st"> </span><span class="kw">as.mcmc</span>(bern_jags)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2"><span class="kw">plot</span>(bern_mcmc)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p><strong>Note:</strong> Kruschke uses <code>rjags</code> without <code>R2jags</code>, so he does this step using
<code>rjags::coda.samples()</code> instead of <code>as.mcmc()</code>. Both functions result
in the same thing – posterior samples in a format that <code>coda</code> expects, but
they have different starting points.</p>
</div>
<div id="using-bayesplot" class="section level3">
<h3><span class="header-section-number">6.2.6</span> Using bayesplot</h3>
<p>The mcmc object we extracted with <code>as.mcmc()</code> can be used by the
utilities in the <code>bayesplot()</code>. Here, for example is the <code>bayesplot</code>
plot of the posterior distribution for theta.
By default, a vertical line segment is drawn at the median of the posterior
distribution.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw">library</span>(bayesplot)</a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="kw">mcmc_areas</span>(</a>
<a class="sourceLine" id="cb50-3" data-line-number="3">  bern_mcmc,            </a>
<a class="sourceLine" id="cb50-4" data-line-number="4">  <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;theta&quot;</span>),     <span class="co"># make a plot for the theta parameter</span></a>
<a class="sourceLine" id="cb50-5" data-line-number="5">  <span class="dt">prob =</span> <span class="fl">0.90</span>)           <span class="co"># shade the central 90%</span></a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>One advantage of <code>bayesplot</code> is that the plots use the <code>ggplot2</code> system and
so interoperate well with <code>ggformula</code>.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw">mcmc_trace</span>(bern_mcmc, <span class="dt">pars =</span> <span class="st">&quot;theta&quot;</span>) </a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="co"># spearate the chains using facets and modify the color scheme</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="kw">mcmc_trace</span>(bern_mcmc, <span class="dt">pars =</span> <span class="st">&quot;theta&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="st">  </span><span class="kw">gf_facet_grid</span>(Chain <span class="op">~</span><span class="st"> </span>.) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-4" data-line-number="4"><span class="st">  </span><span class="kw">gf_refine</span>(<span class="kw">scale_color_viridis_d</span>())</a></code></pre></div>
<pre><code>## Scale for &#39;colour&#39; is already present. Adding another scale for
## &#39;colour&#39;, which will replace the existing scale.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-22-2.png" width="672" /></p>
<p>We will encounter additional plots from <code>bayesplot</code> as we go along.</p>
</div>
<div id="using-kruschkes-functions" class="section level3">
<h3><span class="header-section-number">6.2.7</span> Using Kruschke’s functions</h3>
<p>I have put (modified versions of) some of functions from Kruschke’s book
into the <code>CalvinBayes</code> package so that you don’t have to source his files
to use them.</p>
<div id="diagmcmc" class="section level4">
<h4><span class="header-section-number">6.2.7.1</span> diagMCMC()</h4>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">diagMCMC</span>(bern_mcmc, <span class="dt">par =</span> <span class="st">&quot;theta&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
</div>
<div id="plotpost" class="section level4">
<h4><span class="header-section-number">6.2.7.2</span> plotPost()</h4>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw">plotPost</span>(bern_mcmc[, <span class="st">&quot;theta&quot;</span>], <span class="dt">main =</span> <span class="st">&quot;theta&quot;</span>, <span class="dt">xlab =</span> <span class="kw">expression</span>(theta))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">ESS</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">mode</th>
<th align="right">hdiMass</th>
<th align="right">hdiLow</th>
<th align="right">hdiHigh</th>
<th align="right">compVal</th>
<th align="right">pGtCompVal</th>
<th align="right">ROPElow</th>
<th align="right">ROPEhigh</th>
<th align="right">pLtROPE</th>
<th align="right">pInROPE</th>
<th align="right">pGtROPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>theta</td>
<td align="right">3000</td>
<td align="right">0.3075345</td>
<td align="right">0.3056372</td>
<td align="right">0.2982405</td>
<td align="right">0.95</td>
<td align="right">0.1895683</td>
<td align="right">0.4342434</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">plotPost</span>(bern_mcmc[, <span class="st">&quot;theta&quot;</span>], <span class="dt">main =</span> <span class="st">&quot;theta&quot;</span>, <span class="dt">xlab =</span> <span class="kw">expression</span>(theta),</a>
<a class="sourceLine" id="cb56-2" data-line-number="2">         <span class="dt">cenTend =</span> <span class="st">&quot;median&quot;</span>, <span class="dt">compVal =</span> <span class="fl">0.5</span>, <span class="dt">ROPE =</span> <span class="kw">c</span>(<span class="fl">0.45</span>, <span class="fl">0.55</span>), </a>
<a class="sourceLine" id="cb56-3" data-line-number="3">         <span class="dt">credMass =</span> <span class="fl">0.90</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-24-2.png" width="672" /></p>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">ESS</th>
<th align="right">mean</th>
<th align="right">median</th>
<th align="right">mode</th>
<th align="right">hdiMass</th>
<th align="right">hdiLow</th>
<th align="right">hdiHigh</th>
<th align="right">compVal</th>
<th align="right">pGtCompVal</th>
<th align="right">ROPElow</th>
<th align="right">ROPEhigh</th>
<th align="right">pLtROPE</th>
<th align="right">pInROPE</th>
<th align="right">pGtROPE</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>theta</td>
<td align="right">3000</td>
<td align="right">0.3075345</td>
<td align="right">0.3056372</td>
<td align="right">0.2982405</td>
<td align="right">0.9</td>
<td align="right">0.1983403</td>
<td align="right">0.4072414</td>
<td align="right">0.5</td>
<td align="right">0.0033333</td>
<td align="right">0.45</td>
<td align="right">0.55</td>
<td align="right">0.9866667</td>
<td align="right">0.013</td>
<td align="right">0.0003333</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="optional-arguments-to-jags" class="section level3">
<h3><span class="header-section-number">6.2.8</span> Optional arguments to jags()</h3>
<div id="number-and-size-of-chains" class="section level4">
<h4><span class="header-section-number">6.2.8.1</span> Number and size of chains</h4>
<p>Sometimes we want to use more or longer chains (or fewer or shorter chains
if we are doing a quick preliminary check before running longer chains later).
<code>jags()</code> has three arguments for this:</p>
<ul>
<li><code>n.chains</code>: number of chains</li>
<li><code>n.iter</code>: number of iterations per chain</li>
<li><code>n.burning</code>: number of burn in steps per chain</li>
</ul>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb57-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">76543</span>)</a>
<a class="sourceLine" id="cb57-2" data-line-number="2">bern_jags2 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb57-3" data-line-number="3"><span class="st">  </span><span class="kw">jags</span>(</a>
<a class="sourceLine" id="cb57-4" data-line-number="4">    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> z15N50<span class="op">$</span>y, <span class="dt">N =</span> <span class="kw">nrow</span>(z15N50)),</a>
<a class="sourceLine" id="cb57-5" data-line-number="5">    <span class="dt">model.file =</span> bern_model,</a>
<a class="sourceLine" id="cb57-6" data-line-number="6">    <span class="dt">parameters.to.save =</span> <span class="kw">c</span>(<span class="st">&quot;theta&quot;</span>),</a>
<a class="sourceLine" id="cb57-7" data-line-number="7">    <span class="dt">n.chains =</span> <span class="dv">4</span>, <span class="dt">n.iter =</span> <span class="dv">5000</span>, <span class="dt">n.burnin =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb57-8" data-line-number="8">  )</a></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 50
##    Unobserved stochastic nodes: 1
##    Total graph size: 53
## 
## Initializing model</code></pre>
</div>
<div id="starting-point-for-chains" class="section level4">
<h4><span class="header-section-number">6.2.8.2</span> Starting point for chains</h4>
<p>We can also control the starting point for the chains. Starting different
chains and quite different parameter values can help
* verify that the MCMC algorthm is not overly sensitive to where we are
starting from, and
* ensure that the MCMC algorithm has explored the posterior distribution
sufficiently.
On the other hand, if we start a chain too far from the peak of the
posterior distribution, the chain may have trouble converging.</p>
<p>We can provide either specific starting points for each chain or a function
that generates random starting points.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb59-1" data-line-number="1"><span class="kw">gf_dist</span>(<span class="st">&quot;beta&quot;</span>, <span class="dt">shape1 =</span> <span class="dv">3</span>, <span class="dt">shape2 =</span> <span class="dv">3</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">2345</span>)</a>
<a class="sourceLine" id="cb60-2" data-line-number="2">bern_jags3 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="st">  </span><span class="kw">jags</span>(</a>
<a class="sourceLine" id="cb60-4" data-line-number="4">    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> z15N50<span class="op">$</span>y, <span class="dt">N =</span> <span class="kw">nrow</span>(z15N50)),</a>
<a class="sourceLine" id="cb60-5" data-line-number="5">    <span class="dt">model.file =</span> bern_model,</a>
<a class="sourceLine" id="cb60-6" data-line-number="6">    <span class="dt">parameters.to.save =</span> <span class="kw">c</span>(<span class="st">&quot;theta&quot;</span>),</a>
<a class="sourceLine" id="cb60-7" data-line-number="7">    <span class="dt">n.chains =</span> <span class="dv">4</span>, <span class="dt">n.iter =</span> <span class="dv">5000</span>, <span class="dt">n.burnin =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb60-8" data-line-number="8">    <span class="co"># start each chain &quot;near&quot; 0.5</span></a>
<a class="sourceLine" id="cb60-9" data-line-number="9">    <span class="dt">inits =</span> <span class="cf">function</span>() <span class="kw">list</span>(<span class="dt">theta =</span> <span class="kw">rbeta</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>))    </a>
<a class="sourceLine" id="cb60-10" data-line-number="10">  )</a></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 50
##    Unobserved stochastic nodes: 1
##    Total graph size: 53
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">bern_jags4 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="st">  </span><span class="kw">jags</span>(</a>
<a class="sourceLine" id="cb62-3" data-line-number="3">    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> z15N50<span class="op">$</span>y, <span class="dt">N =</span> <span class="kw">nrow</span>(z15N50)),</a>
<a class="sourceLine" id="cb62-4" data-line-number="4">    <span class="dt">model.file =</span> bern_model,</a>
<a class="sourceLine" id="cb62-5" data-line-number="5">    <span class="dt">parameters.to.save =</span> <span class="kw">c</span>(<span class="st">&quot;theta&quot;</span>),</a>
<a class="sourceLine" id="cb62-6" data-line-number="6">    <span class="dt">n.chains =</span> <span class="dv">3</span>, <span class="dt">n.iter =</span> <span class="dv">550</span>, <span class="dt">n.burnin =</span> <span class="dv">500</span>,</a>
<a class="sourceLine" id="cb62-7" data-line-number="7">    <span class="co"># choose specific starting point for each chain</span></a>
<a class="sourceLine" id="cb62-8" data-line-number="8">    <span class="dt">inits =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb62-9" data-line-number="9">      <span class="kw">list</span>(<span class="dt">theta =</span> <span class="fl">0.5</span>), <span class="kw">list</span>(<span class="dt">theta =</span> <span class="fl">0.3</span>), <span class="kw">list</span>(<span class="dt">theta =</span> <span class="fl">0.7</span>)</a>
<a class="sourceLine" id="cb62-10" data-line-number="10">    )</a>
<a class="sourceLine" id="cb62-11" data-line-number="11">  )</a></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 50
##    Unobserved stochastic nodes: 1
##    Total graph size: 53
## 
## Initializing model</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"><span class="kw">mcmc_trace</span>(<span class="kw">as.mcmc</span>(bern_jags4), <span class="dt">pars =</span> <span class="st">&quot;theta&quot;</span>)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-27-2.png" width="672" /></p>
</div>
<div id="running-chains-in-parallel" class="section level4">
<h4><span class="header-section-number">6.2.8.3</span> Running chains in parallel</h4>
<p>Although this model runs very quickly, others models may take considerably
longer.
We can use <code>jags.parallel()</code> in place of <code>jags()</code>
to take advantage of multiple cores to run more than one chain at a
time. <code>jags.seed</code> can be used to set the seed for the parallel
random number generator used. (Note: <code>set.seed()</code> does not work when
using <code>jags.parallel()</code> and <code>jags.seed</code> has no effect when using <code>jags()</code>.)</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1"><span class="kw">library</span>(R2jags)</a>
<a class="sourceLine" id="cb65-2" data-line-number="2">bern_jags3 &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb65-3" data-line-number="3"><span class="st">  </span><span class="kw">jags.parallel</span>(</a>
<a class="sourceLine" id="cb65-4" data-line-number="4">    <span class="dt">data =</span> <span class="kw">list</span>(<span class="dt">y =</span> z15N50<span class="op">$</span>y, <span class="dt">N =</span> <span class="kw">nrow</span>(z15N50)),</a>
<a class="sourceLine" id="cb65-5" data-line-number="5">    <span class="dt">model.file =</span> bern_model,</a>
<a class="sourceLine" id="cb65-6" data-line-number="6">    <span class="dt">parameters.to.save =</span> <span class="kw">c</span>(<span class="st">&quot;theta&quot;</span>),</a>
<a class="sourceLine" id="cb65-7" data-line-number="7">    <span class="dt">n.chains =</span> <span class="dv">4</span>, <span class="dt">n.iter =</span> <span class="dv">5000</span>, <span class="dt">n.burnin =</span> <span class="dv">1000</span>,</a>
<a class="sourceLine" id="cb65-8" data-line-number="8">    <span class="dt">jags.seed =</span> <span class="dv">12345</span></a>
<a class="sourceLine" id="cb65-9" data-line-number="9">  )</a></code></pre></div>
</div>
</div>
</div>
<div id="example-2-comparing-two-proportions" class="section level2">
<h2><span class="header-section-number">6.3</span> Example 2: comparing two proportions</h2>
<div id="the-data" class="section level3">
<h3><span class="header-section-number">6.3.1</span> The data</h3>
<p>Suppose we want to compare Reginald and Tony’s abilities to hit a target (with a
dart, perhaps). For each attempt, we record two pieces of information: the person
making the attampt (the subject) and whether the attempt succeeded (0 or 1).</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"><span class="kw">library</span>(mosaic)</a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="kw">head</span>(z6N8z2N7)   </a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">y</th>
<th align="left">s</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">Reginald</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="left">Reginald</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Reginald</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Reginald</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">Reginald</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">Reginald</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1"><span class="co"># Let&#39;s do some renaming</span></a>
<a class="sourceLine" id="cb67-2" data-line-number="2">Target &lt;-<span class="st"> </span>z6N8z2N7 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">hit =</span> y, <span class="dt">subject =</span> s)</a>
<a class="sourceLine" id="cb67-4" data-line-number="4"><span class="kw">df_stats</span>(hit <span class="op">~</span><span class="st"> </span>subject, <span class="dt">data =</span> Target, props, <span class="dt">attempts =</span> length)</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">subject</th>
<th align="right">prop_0</th>
<th align="right">prop_1</th>
<th align="right">attempts</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Reginald</td>
<td align="right">0.2500000</td>
<td align="right">0.7500000</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Tony</td>
<td align="right">0.7142857</td>
<td align="right">0.2857143</td>
<td align="right">7</td>
</tr>
</tbody>
</table>
</div>
<div id="the-model-1" class="section level3">
<h3><span class="header-section-number">6.3.2</span> The model</h3>
<p>Now our model is that each person has his own success rate – we have **two <span class="math inline">\(\theta\)</span>’s,
one for Reginald and one for Tony.</p>
<p><img src="images/Bernoulli-model.png" width="914" /></p>
<p>We express this as</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">hit <span class="op">~</span><span class="st"> </span><span class="kw">dbern</span>(theta[subject[i]])</a></code></pre></div>
<p>where <code>subject[i]</code> tells us which subject the <code>i</code>th observation was for.</p>
</div>
<div id="describing-the-model-to-jags" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Describing the model to JAGS</h3>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">bern2_model &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb69-2" data-line-number="2">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>Nobs) {</a>
<a class="sourceLine" id="cb69-3" data-line-number="3">    <span class="co"># each response is Bernoulli with the appropriate theta</span></a>
<a class="sourceLine" id="cb69-4" data-line-number="4">    hit[i] <span class="op">~</span><span class="st"> </span><span class="kw">dbern</span>(theta[subject[i]])  </a>
<a class="sourceLine" id="cb69-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb69-6" data-line-number="6">  <span class="cf">for</span> (s <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>Nsub) {</a>
<a class="sourceLine" id="cb69-7" data-line-number="7">    theta[s] <span class="op">~</span><span class="st"> </span><span class="kw">dbeta</span>(<span class="dv">2</span>, <span class="dv">2</span>)    <span class="co"># prior for each theta</span></a>
<a class="sourceLine" id="cb69-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb69-9" data-line-number="9">}</a></code></pre></div>
<p>JAGS will also need access to four pieces of information from our data set:</p>
<ul>
<li>a vector of <code>hit</code> values</li>
<li>a vector of <code>subject</code> values – coded as integers 1 and 2 (so that <code>subject[i]</code>
makes sense to JAGS. (In general, JAGS is much less fluid in handling data than
R is, so we often need to do some manual data conversion for JAGSS.)</li>
<li><code>Nobs</code> – the total number of observations</li>
<li><code>Nsub</code> – the number of subjects</li>
</ul>
<p>We will prepare these as a list.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1">TargetList &lt;-</a>
<a class="sourceLine" id="cb70-2" data-line-number="2"><span class="st">  </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb70-3" data-line-number="3">    <span class="dt">Nobs =</span> <span class="kw">nrow</span>(Target),</a>
<a class="sourceLine" id="cb70-4" data-line-number="4">    <span class="dt">Nsub =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb70-5" data-line-number="5">    <span class="dt">hit =</span> Target<span class="op">$</span>hit,</a>
<a class="sourceLine" id="cb70-6" data-line-number="6">    <span class="dt">subject =</span> <span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(Target<span class="op">$</span>subject))</a>
<a class="sourceLine" id="cb70-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb70-8" data-line-number="8">TargetList</a></code></pre></div>
<pre><code>## $Nobs
## [1] 15
## 
## $Nsub
## [1] 2
## 
## $hit
##  [1] 1 0 1 1 1 1 1 0 0 0 1 0 0 1 0
## 
## $subject
##  [1] 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2</code></pre>
</div>
<div id="fitting-the-model" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Fitting the model</h3>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1">bern2_jags &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb72-2" data-line-number="2"><span class="st">  </span><span class="kw">jags</span>(</a>
<a class="sourceLine" id="cb72-3" data-line-number="3">    <span class="dt">data =</span> TargetList,</a>
<a class="sourceLine" id="cb72-4" data-line-number="4">    <span class="dt">model.file =</span> bern2_model,</a>
<a class="sourceLine" id="cb72-5" data-line-number="5">    <span class="dt">parameters.to.save =</span> <span class="st">&quot;theta&quot;</span>)</a></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 15
##    Unobserved stochastic nodes: 2
##    Total graph size: 35
## 
## Initializing model</code></pre>
</div>
<div id="inspecting-the-results" class="section level3">
<h3><span class="header-section-number">6.3.5</span> Inspecting the results</h3>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1">bern2_mcmc &lt;-<span class="st"> </span><span class="kw">as.mcmc</span>(bern2_jags)</a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="kw">diagMCMC</span>(bern2_mcmc)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="co"># bayesplot plots</span></a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="kw">mcmc_acf</span>(bern2_mcmc)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-2.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">mcmc_acf_bar</span>(bern2_mcmc)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-3.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw">mcmc_pairs</span>(bern2_mcmc, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;theta[1]&quot;</span>, <span class="st">&quot;theta[2]&quot;</span>))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-4.png" width="672" /></p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw">mcmc_combo</span>(bern2_mcmc)</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-5.png" width="672" /></p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">mcmc_combo</span>(bern2_mcmc, <span class="dt">combo =</span> <span class="kw">c</span>(<span class="st">&quot;dens&quot;</span>, <span class="st">&quot;dens_overlay&quot;</span>, <span class="st">&quot;trace&quot;</span>, <span class="st">&quot;scatter&quot;</span>), </a>
<a class="sourceLine" id="cb79-2" data-line-number="2">           <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">&quot;theta[1]&quot;</span>, <span class="st">&quot;theta[2]&quot;</span>))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-35-6.png" width="672" /></p>
<p>Here is a list of <code>mcmc_</code> functions available:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">apropos</span>(<span class="st">&quot;^mcmc_&quot;</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;mcmc_acf&quot;               &quot;mcmc_acf_bar&quot;          
##  [3] &quot;mcmc_areas&quot;             &quot;mcmc_areas_data&quot;       
##  [5] &quot;mcmc_areas_ridges&quot;      &quot;mcmc_areas_ridges_data&quot;
##  [7] &quot;mcmc_combo&quot;             &quot;mcmc_dens&quot;             
##  [9] &quot;mcmc_dens_chains&quot;       &quot;mcmc_dens_chains_data&quot; 
## [11] &quot;mcmc_dens_overlay&quot;      &quot;mcmc_hex&quot;              
## [13] &quot;mcmc_hist&quot;              &quot;mcmc_hist_by_chain&quot;    
## [15] &quot;mcmc_intervals&quot;         &quot;mcmc_intervals_data&quot;   
## [17] &quot;mcmc_neff&quot;              &quot;mcmc_neff_data&quot;        
## [19] &quot;mcmc_neff_hist&quot;         &quot;mcmc_nuts_acceptance&quot;  
## [21] &quot;mcmc_nuts_divergence&quot;   &quot;mcmc_nuts_energy&quot;      
## [23] &quot;mcmc_nuts_stepsize&quot;     &quot;mcmc_nuts_treedepth&quot;   
## [25] &quot;mcmc_pairs&quot;             &quot;mcmc_parcoord&quot;         
## [27] &quot;mcmc_parcoord_data&quot;     &quot;mcmc_recover_hist&quot;     
## [29] &quot;mcmc_recover_intervals&quot; &quot;mcmc_recover_scatter&quot;  
## [31] &quot;mcmc_rhat&quot;              &quot;mcmc_rhat_data&quot;        
## [33] &quot;mcmc_rhat_hist&quot;         &quot;mcmc_scatter&quot;          
## [35] &quot;mcmc_trace&quot;             &quot;mcmc_trace_highlight&quot;  
## [37] &quot;mcmc_violin&quot;</code></pre>
<p>The functions ending in <code>_data()</code> return the data used to make the corresponding plot. This can be useful
if you want to display that same infromation in a different way or
if you just want to inspect the data to make sure you understand the plot.</p>
</div>
<div id="differnce-in-proportions" class="section level3">
<h3><span class="header-section-number">6.3.6</span> Differnce in proportions</h3>
<p>If we are primarily interested in the difference between Reginald and Tony, we can plot the difference
in their theta values.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">posterior</span>(bern2_jags))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">deviance</th>
<th align="right">theta.1</th>
<th align="right">theta.2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">18.54436</td>
<td align="right">0.5707752</td>
<td align="right">0.2463970</td>
</tr>
<tr class="even">
<td align="right">23.64073</td>
<td align="right">0.3772347</td>
<td align="right">0.5269200</td>
</tr>
<tr class="odd">
<td align="right">18.68776</td>
<td align="right">0.6122157</td>
<td align="right">0.4316202</td>
</tr>
<tr class="even">
<td align="right">18.97816</td>
<td align="right">0.5955774</td>
<td align="right">0.1552301</td>
</tr>
<tr class="odd">
<td align="right">19.25650</td>
<td align="right">0.5276570</td>
<td align="right">0.2124313</td>
</tr>
<tr class="even">
<td align="right">19.26544</td>
<td align="right">0.5203864</td>
<td align="right">0.3450249</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw">gf_density</span>( <span class="op">~</span>(theta<span class="fl">.1</span> <span class="op">-</span><span class="st"> </span>theta<span class="fl">.2</span>), <span class="dt">data =</span> <span class="kw">posterior</span>(bern2_jags))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
</div>
<div id="sampling-from-the-prior" class="section level3">
<h3><span class="header-section-number">6.3.7</span> Sampling from the prior</h3>
<p>To sample from the prior, we must do the following:</p>
<ul>
<li>remove the response variable from our data list</li>
<li>change <code>Nobs</code> to 0</li>
<li>set <code>DIC = FALSE</code> in the call to <code>jags()</code>.</li>
</ul>
<p>This will run the model witout any data, which means the posterior will be the same
as the prior.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"><span class="co"># make a copy of our data list</span></a>
<a class="sourceLine" id="cb84-2" data-line-number="2">TargetList0 &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb84-3" data-line-number="3">  <span class="dt">Nobs =</span> <span class="dv">0</span>,  </a>
<a class="sourceLine" id="cb84-4" data-line-number="4">  <span class="dt">Nsub =</span> <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb84-5" data-line-number="5">  <span class="dt">subject =</span> <span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(Target<span class="op">$</span>subject))</a>
<a class="sourceLine" id="cb84-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb84-7" data-line-number="7"></a>
<a class="sourceLine" id="cb84-8" data-line-number="8">bern2_jags0 &lt;-</a>
<a class="sourceLine" id="cb84-9" data-line-number="9"><span class="st">  </span><span class="kw">jags</span>(</a>
<a class="sourceLine" id="cb84-10" data-line-number="10">    <span class="dt">data =</span> TargetList0,</a>
<a class="sourceLine" id="cb84-11" data-line-number="11">    <span class="dt">model.file =</span> bern2_model,</a>
<a class="sourceLine" id="cb84-12" data-line-number="12">    <span class="dt">parameters.to.save =</span> <span class="kw">c</span>(<span class="st">&quot;theta&quot;</span>),</a>
<a class="sourceLine" id="cb84-13" data-line-number="13">    <span class="dt">DIC =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Compiling model graph
##    Resolving undeclared variables
##    Allocating nodes
## Graph information:
##    Observed stochastic nodes: 0
##    Unobserved stochastic nodes: 2
##    Total graph size: 20
## 
## Initializing model</code></pre>
<div id="note-about-in-jags-and-in-r" class="section level4">
<h4><span class="header-section-number">6.3.7.1</span> Note about : in JAGS and in R</h4>
<p>From the JAGS documentation:
&gt; The sequence operator <code>:</code> can only produce increasing sequences. If n &lt; m then <code>m:n</code>
produces a vector of length zero and when this is used in a for loop index expression the
contents of loop inside the curly brackets are skipped. Note that this behaviour is different
from the sequence operator in R, where <code>m:n</code> will produce a decreasing sequence if <code>n &lt; m</code>.</p>
<p>So in our JAGS model, <code>1:0</code> correctly represents no data (and no trips through the for loop).</p>
</div>
<div id="what-good-is-it-to-generate-samples-from-the-prior" class="section level4">
<h4><span class="header-section-number">6.3.7.2</span> What good is it to generate samples from the prior?</h4>
<p>Our model set priors for <span class="math inline">\(\theta_1\)</span> and <span class="math inline">\(\theta_2\)</span>, but this implies a distribution
for <span class="math inline">\(\theta_1 - \theta_2\)</span>, and we might like to see what that distribution looks like.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">gf_density</span>( <span class="op">~</span>(theta<span class="fl">.1</span> <span class="op">-</span><span class="st"> </span>theta<span class="fl">.2</span>), <span class="dt">data =</span> <span class="kw">posterior</span>(bern2_jags0))</a></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="bayes-rule-and-the-grid-method.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="heierarchical-models.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
